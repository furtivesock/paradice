{% extends 'base.html.twig' %}
{% block title %}Hello!{% endblock %}
{% block javascripts %}
    <script src="/js/status/story.js"></script>
    <script src="/js/chat/messages.js"></script>
{% endblock %}
{% block body %}

    <h2>{{ chapter.getName }}</h2>
    {% if user is defined and user is not null %}
        {% set universe = chapter.story.universe %}
        {% if not (universe.isMember(user) or universe.isCreator(user) or universe.isModerator(user) or universe.isApplicant(user)) %}
            <p><a href="/universe/{{ universe.id }}/application/new">Joindre {{ universe.name }}</a></p>
        {% endif %}

        {% if chapter.story.isAuthor(user) %}
            <div id="status" universe="{{ chapter.story.universe.id }}" story="{{ chapter.story.id }}">
                <select v-model:value="curStatus">
                    <option :value="status.id" v-for="status in allStatus">${ status.name }</option>
                </select>
            </div>
        {% endif %}
        
    {% endif %}

    <div id="messages" universe={{ chapter.story.universe.id }} story={{ chapter.story.id }} chapter={{ chapter.id }}>
        
        {# Show the area for sending a message if the user is a player #}
        {% if user is defined and user is not null %} 
            {% if chapter.story.isPlayer(user) or chapter.story.isAuthor(user) %}
                <textarea id="messageToSend" name="messageToSend" placeholder="Votre message"></textarea>
                <button name="sendMessageButton" type="button" v-on:click="sendMessage()">Envoyer</button>
            {% else %}
                <p><i>Vous n'Ãªtes pas un joueur de l'histoire. Vous ne pouvez donc pas poster de message</i></p>
            {% endif %}
        {% else %}
            <p><i>Connectez-vous pour envoyer un message</i></p>
        {% endif %}


        {# Show the messages #}
        <div :key="message.id" v-for="message in reverseMessages">
            <h5 :href="'/user/' + message.id + '/profile'">
                <span v-if="message.sender.is_author">${ message.sender.name } (MJ)</span>
                <span v-else>${ message.sender.firstname } ${ message.sender.lastname }</span>
            </h5>
            <p>${ message.contents }</p>
            <p>${ message.creationDate.date }</p>
        </div>
    </div>
{% endblock %}